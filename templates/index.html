<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Balance Sheet - Expense Tracker</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <nav class="navbar navbar-dark bg-primary">
        <div class="container-fluid">
            <span class="navbar-brand mb-0 h1">
                <i class="bi bi-wallet2"></i> Balance Sheet
            </span>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- Statistics Cards -->
        <div class="row mb-4 g-3" id="stats-cards">
            <div class="col-md-4">
                <div class="card text-center clickable-card" style="border-left: 4px solid #10b981; cursor: pointer;" onclick="filterByTransactionType('income')">
                    <div class="card-body py-3">
                        <div class="d-flex align-items-center justify-content-between">
                            <div>
                                <h6 class="mb-0 text-muted">ðŸ’° INCOME</h6>
                                <small class="text-muted"><em>(2025)</em></small>
                            </div>
                            <div class="text-end">
                                <h3 class="mb-0" id="total-income" style="color: #10b981; font-weight: 600;">$0.00</h3>
                                <small class="text-muted" id="month-income-text">Month: $0</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card text-center clickable-card" style="border-left: 4px solid #ef4444; cursor: pointer;" onclick="filterByTransactionType('expense')">
                    <div class="card-body py-3">
                        <div class="d-flex align-items-center justify-content-between">
                            <div>
                                <h6 class="mb-0 text-muted">ðŸ’¸ EXPENSES</h6>
                                <small class="text-muted"><em>(2025)</em></small>
                            </div>
                            <div class="text-end">
                                <h3 class="mb-0" id="total-expenses" style="color: #ef4444; font-weight: 600;">$0.00</h3>
                                <small class="text-muted" id="month-expenses-text">Month: $0</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card text-center" style="border-left: 4px solid #3b82f6;">
                    <div class="card-body py-3">
                        <div class="d-flex align-items-center justify-content-between">
                            <div>
                                <h6 class="mb-0 text-muted">ðŸ“Š NET</h6>
                                <small class="text-muted"><em>(2025)</em></small>
                            </div>
                            <div class="text-end">
                                <h3 class="mb-0" id="net-position" style="color: #3b82f6; font-weight: 600;">$0.00</h3>
                                <small class="text-muted" id="month-net-text">Month: $0</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row mb-4 g-3">
            <div class="col-md-6">
                <div class="card text-center" style="border-left: 4px solid #10b981;">
                    <div class="card-body py-3">
                        <div class="d-flex align-items-center justify-content-between">
                            <div>
                                <h6 class="mb-0 text-muted">âœ“ ESSENTIAL</h6>
                                <small class="text-muted"><em>(2025)</em></small>
                            </div>
                            <h3 class="mb-0" id="essential-expenses" style="color: #10b981; font-weight: 600;">$0.00</h3>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card text-center" style="border-left: 4px solid #8b5cf6;">
                    <div class="card-body py-3">
                        <div class="d-flex align-items-center justify-content-between">
                            <div>
                                <h6 class="mb-0 text-muted">â—† OPTIONAL</h6>
                                <small class="text-muted"><em>(2025)</em></small>
                            </div>
                            <h3 class="mb-0" id="optional-expenses" style="color: #8b5cf6; font-weight: 600;">$0.00</h3>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Cash Position & Runway Card -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card" style="border-left: 4px solid #f59e0b;">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h5 class="mb-0" style="color: #f59e0b;">ðŸ’µ Cash Position & Runway</h5>
                            <button class="btn btn-primary btn-sm" onclick="showAddCashPositionModal()">
                                <i class="bi bi-plus-circle"></i> Update Cash
                            </button>
                        </div>
                        <div class="row g-3">
                            <div class="col-md-3">
                                <div class="text-center">
                                    <small class="text-muted d-block">CURRENT CASH</small>
                                    <h4 class="mb-0" id="current-cash" style="color: #f59e0b;">$0.00</h4>
                                    <small class="text-muted" id="cash-date">No data</small>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="text-center">
                                    <small class="text-muted d-block">RUNWAY</small>
                                    <h4 class="mb-0" id="runway-months" style="color: #10b981;">-- months</h4>
                                    <small class="text-muted" id="runway-date">--</small>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="text-center">
                                    <small class="text-muted d-block">MONTHLY BURN</small>
                                    <h4 class="mb-0" id="monthly-burn" style="color: #ef4444;">$0.00</h4>
                                    <small class="text-muted">Avg last 3 months</small>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="text-center">
                                    <small class="text-muted d-block">QUICK ACTIONS</small>
                                    <button class="btn btn-outline-primary btn-sm" onclick="showCashHistoryModal()">
                                        <i class="bi bi-clock-history"></i> History
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Selection Tally Bar (fixed at bottom) -->
        <div id="selection-tally-bar" style="display: none; position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: var(--bg-card); border: 2px solid var(--primary); border-radius: 12px; padding: 1rem 2rem; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6); z-index: 1000; min-width: 400px;">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <span id="selection-count" class="badge bg-primary me-2">0</span>
                    <span style="color: var(--text-primary);">transactions selected</span>
                </div>
                <div class="ms-4">
                    <strong style="color: var(--text-primary);">Total: </strong>
                    <strong id="selection-total" style="color: var(--primary); font-size: 1.2rem;">$0.00</strong>
                </div>
                <button class="btn btn-sm btn-outline-primary ms-3" onclick="clearSelection()">
                    <i class="bi bi-x-circle"></i> Clear
                </button>
            </div>
        </div>

        <!-- Tab Navigation -->
        <ul class="nav nav-tabs mb-4" role="tablist">
            <li class="nav-item">
                <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#expenses-tab">
                    <i class="bi bi-list-ul"></i> Transactions
                </button>
            </li>
            <li class="nav-item">
                <button class="nav-link" data-bs-toggle="tab" data-bs-target="#reports-tab">
                    <i class="bi bi-bar-chart"></i> Reports
                </button>
            </li>
            <li class="nav-item">
                <button class="nav-link" data-bs-toggle="tab" data-bs-target="#import-tab">
                    <i class="bi bi-upload"></i> Import
                </button>
            </li>
            <li class="nav-item">
                <button class="nav-link" data-bs-toggle="tab" data-bs-target="#settings-tab">
                    <i class="bi bi-gear"></i> Settings
                </button>
            </li>
        </ul>

        <!-- Tab Content -->
        <div class="tab-content">
            <!-- Expenses Tab -->
            <div class="tab-pane fade show active" id="expenses-tab">
                <!-- Search and Filter Bar -->
                <div class="card mb-3">
                    <div class="card-body">
                        <div class="row g-2 align-items-end">
                            <div class="col-md-3">
                                <label class="form-label small text-muted mb-1">Search</label>
                                <div class="input-group input-group-sm">
                                    <span class="input-group-text"><i class="bi bi-search"></i></span>
                                    <input type="text" class="form-control" id="search-expenses" placeholder="Search...">
                                </div>
                            </div>
                            <div class="col-md-2">
                                <label class="form-label small text-muted mb-1">Year</label>
                                <select class="form-select form-select-sm" id="filter-year">
                                    <option value="">All Years</option>
                                    <option value="2025" selected>2025</option>
                                    <option value="2024">2024</option>
                                </select>
                            </div>
                            <div class="col-md-2">
                                <label class="form-label small text-muted mb-1">Transaction</label>
                                <select class="form-select form-select-sm" id="filter-transaction-type">
                                    <option value="">All</option>
                                    <option value="income">ðŸ’° Income</option>
                                    <option value="expense">ðŸ’¸ Expense</option>
                                </select>
                            </div>
                            <div class="col-md-2">
                                <label class="form-label small text-muted mb-1">Category</label>
                                <select class="form-select form-select-sm" id="filter-category">
                                    <option value="">All</option>
                                </select>
                            </div>
                            <div class="col-md-2">
                                <label class="form-label small text-muted mb-1">Type</label>
                                <select class="form-select form-select-sm" id="filter-type">
                                    <option value="">All</option>
                                    <option value="essential">âœ“ Essential</option>
                                    <option value="optional">â—† Optional</option>
                                </select>
                            </div>
                            <div class="col-md-1">
                                <button class="btn btn-outline-secondary btn-sm w-100" onclick="clearFilters()">
                                    <i class="bi bi-x-circle"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Monthly Tabs -->
                <div class="card">
                    <div class="card-header">
                        <ul class="nav nav-pills card-header-pills" id="monthly-tabs" role="tablist">
                            <!-- Monthly tabs will be generated by JavaScript -->
                        </ul>
                    </div>
                    <div class="card-body">
                        <div class="tab-content" id="monthly-tab-content">
                            <!-- Monthly content will be generated by JavaScript -->
                        </div>
                    </div>
                </div>

                <!-- Add Expense Modal -->
                <button type="button" class="btn btn-primary btn-lg position-fixed bottom-0 end-0 m-4 rounded-circle"
                        data-bs-toggle="modal" data-bs-target="#addExpenseModal" style="width: 60px; height: 60px; z-index: 1000;">
                    <i class="bi bi-plus-lg"></i>
                </button>

                <!-- Add Expense Modal -->
                <div class="modal fade" id="addExpenseModal" tabindex="-1">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Add Expense</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <form id="expense-form">
                                    <div class="mb-3">
                                        <label class="form-label">Description</label>
                                        <input type="text" class="form-control" id="description" required>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Amount</label>
                                        <input type="number" class="form-control" id="amount" step="0.01" required>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Date</label>
                                        <input type="date" class="form-control" id="date" required>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Category</label>
                                        <select class="form-select" id="category">
                                            <option value="">Select Category</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Tags (comma separated)</label>
                                        <input type="text" class="form-control" id="tags" placeholder="e.g., groceries, weekly">
                                    </div>
                                    <div class="mb-3 form-check">
                                        <input type="checkbox" class="form-check-input" id="is-recurring">
                                        <label class="form-check-label" for="is-recurring">Recurring Expense</label>
                                    </div>
                                    <div class="mb-3" id="recurring-options" style="display: none;">
                                        <label class="form-label">Frequency</label>
                                        <select class="form-select" id="recurring-frequency">
                                            <option value="daily">Daily</option>
                                            <option value="weekly">Weekly</option>
                                            <option value="monthly">Monthly</option>
                                            <option value="yearly">Yearly</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Notes</label>
                                        <textarea class="form-control" id="notes" rows="2"></textarea>
                                    </div>
                                    <button type="submit" class="btn btn-primary w-100">
                                        <i class="bi bi-plus-circle"></i> Add Expense
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Reports Tab -->
            <div class="tab-pane fade" id="reports-tab">
                <div class="row mb-3 align-items-end">
                    <div class="col-md-6">
                        <div class="btn-group period-selector" role="group">
                            <button type="button" class="btn btn-outline-primary active" id="period-month" onclick="selectPeriod('month')">This Month</button>
                            <button type="button" class="btn btn-outline-primary" id="period-year" onclick="selectPeriod('year')">This Year</button>
                            <button type="button" class="btn btn-outline-primary" id="period-all" onclick="selectPeriod('all')">All Time</button>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label small text-muted mb-1">Or select specific month:</label>
                        <select class="form-select" id="month-selector" onchange="selectSpecificMonth()">
                            <option value="">Select a month...</option>
                        </select>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5>Expenses by Category</h5>
                            </div>
                            <div class="card-body">
                                <canvas id="category-chart"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5>Monthly Trend</h5>
                            </div>
                            <div class="card-body">
                                <canvas id="trend-chart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Advanced Analytics Section -->
                <div class="row mt-4" id="advanced-analytics">
                    <!-- Analytics cards will be populated by JavaScript -->
                </div>
            </div>

            <!-- Import Tab -->
            <div class="tab-pane fade" id="import-tab">
                <div class="row">
                    <div class="col-md-8 offset-md-2">
                        <div class="card">
                            <div class="card-header">
                                <h5>Import Bank/Credit Card Statements</h5>
                            </div>
                            <div class="card-body">
                                <div class="alert alert-info">
                                    <strong>CSV Formats Supported:</strong>
                                    <br>
                                    â€¢ <strong>Format 1 (Amex):</strong> <code>date</code>, <code>description</code>, <code>amount</code>
                                    <br>
                                    â€¢ <strong>Format 2 (Bank):</strong> <code>date</code>, <code>description</code>, <code>debits and credits</code>, <code>balance</code>
                                    <br>
                                    &nbsp;&nbsp;<small class="text-muted">Debits in parentheses (123.45), credits without 123.45</small>
                                    <br><br>
                                    <strong>Supported date formats:</strong> YYYY-MM-DD, MM/DD/YYYY, DD/MM/YYYY
                                    <br><br>
                                    <strong>ðŸ’¡ Tip:</strong> You can select multiple CSV files at once!
                                </div>
                                <form id="import-form">
                                    <div class="mb-3">
                                        <label class="form-label">Select CSV Files (one or more)</label>
                                        <input type="file" class="form-control" id="csv-file" accept=".csv" multiple required>
                                        <small class="form-text text-muted">Hold Ctrl (Windows) or Cmd (Mac) to select multiple files</small>
                                    </div>
                                    <button type="submit" class="btn btn-primary">
                                        <i class="bi bi-upload"></i> Import Transactions
                                    </button>
                                </form>
                                <div id="import-result" class="mt-3"></div>
                            </div>
                        </div>

                        <div class="card mt-4">
                            <div class="card-header bg-danger text-white">
                                <h5><i class="bi bi-exclamation-triangle"></i> Danger Zone</h5>
                            </div>
                            <div class="card-body">
                                <p class="text-muted">Delete all expenses from the database. This action cannot be undone!</p>
                                <button type="button" class="btn btn-danger" onclick="confirmDeleteAll()">
                                    <i class="bi bi-trash"></i> Delete All Expenses
                                </button>
                            </div>
                        </div>

                        <div class="card mt-4">
                            <div class="card-header">
                                <h5>Sample CSV Format</h5>
                            </div>
                            <div class="card-body">
                                <pre class="bg-light p-3">date,description,amount,category
2024-01-15,Grocery Store,45.32,Food & Dining
2024-01-16,Gas Station,52.00,Transportation
2024-01-17,Netflix Subscription,15.99,Entertainment</pre>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Tab -->
            <div class="tab-pane fade" id="settings-tab">
                <div class="row">
                    <div class="col-md-8 offset-md-2">
                        <div class="card">
                            <div class="card-header">
                                <h5>Category Management</h5>
                            </div>
                            <div class="card-body">
                                <p class="text-muted mb-3">Manage your expense categories. Deleting a category will set all associated expenses to "Uncategorized".</p>
                                <div id="category-list" class="list-group">
                                    <!-- Categories will be loaded here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Cash Position Modal -->
    <div class="modal fade" id="addCashPositionModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Update Cash Position</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="cash-position-form">
                        <div class="mb-3">
                            <label class="form-label">Date</label>
                            <input type="date" class="form-control" id="cash-date-input" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Cash Amount</label>
                            <input type="number" class="form-control" id="cash-amount-input" step="0.01" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Notes (Optional)</label>
                            <textarea class="form-control" id="cash-notes-input" rows="2"></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">Save Cash Position</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Cash History Modal -->
    <div class="modal fade" id="cashHistoryModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Cash Position History</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Amount</th>
                                    <th>Notes</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="cash-history-table">
                                <!-- History will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
